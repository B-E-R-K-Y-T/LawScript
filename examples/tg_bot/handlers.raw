ОПРЕДЕЛИТЬ ПРОЦЕДУРУ обработчик_текста(адрес, очередь_событий) (
    ЗАДАТЬ сообщение;
    ЗАДАТЬ идентификатор_чата;
    ЗАДАТЬ текст;

    ПОКА ИСТИНА (
        КОНТЕКСТ (
            сообщение = очередь_событий:взять();
        )
        ОБРАБОТЧИК ОчередьПуста КАК _ (
            спать(0.5);
            ПРОПУСТИТЬ;
        )

        ЕСЛИ НЕ есть_ключ_в_таблице(сообщение, "text") ТО (
            ПРОПУСТИТЬ;
        )

        идентификатор_чата = извлечь_из_таблицы(извлечь_из_таблицы(сообщение, "chat"), "id");
        текст = форматировать_строку("Эхо: {}", извлечь_из_таблицы(сообщение, "text"));

        В ФОНЕ отправить_сообщение(адрес, идентификатор_чата, текст);
    )
)
