ВКЛЮЧИТЬ стандартная_библиотека.интернет
ВКЛЮЧИТЬ стандартная_библиотека.время
ВКЛЮЧИТЬ стандартная_библиотека.рандом
ВКЛЮЧИТЬ стандартная_библиотека.строки
ВКЛЮЧИТЬ стандартная_библиотека.конкурентность
ВКЛЮЧИТЬ стандартная_библиотека.ввод_вывод
ВКЛЮЧИТЬ стандартная_библиотека.структуры.*

ВКЛЮЧИТЬ config.*
ВКЛЮЧИТЬ bot.updater
ВКЛЮЧИТЬ bot.sender
ВКЛЮЧИТЬ handlers


ОПРЕДЕЛИТЬ ПРОЦЕДУРУ главная() (
    ЗАДАТЬ фоновые_задачи = Список();
    ЗАДАТЬ события = Очередь(100);
    ЗАДАТЬ настройки = Настройки();
    ЗАДАТЬ ТОКЕН = настройки:токен;
    ЗАДАТЬ БАЗОВЫЙ_АДРЕС = форматировать_строку("{}{}", настройки:адрес, ТОКЕН);
    ЗАДАТЬ актуализатор = Актуализатор(БАЗОВЫЙ_АДРЕС, ТОКЕН);

    фоновые_задачи:добавить(В ФОНЕ актуализатор:ожидание_новых_событий(события));
    фоновые_задачи:добавить(В ФОНЕ обработчик_текста(БАЗОВЫЙ_АДРЕС, события));

    НАПЕЧАТАТЬ "Бот запущен! И ждет сообщений...";

    ждать_всех(фоновые_задачи:в_массив());
)

ВЫПОЛНИТЬ (
    главная();
)
