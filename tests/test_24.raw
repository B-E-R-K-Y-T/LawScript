ВКЛЮЧИТЬ стандартная_библиотека.*


ОПРЕДЕЛИТЬ КЛАСС ФоновыйЧел (
    ОПРЕДЕЛИТЬ КОНСТРУКТОР (ссылка)() (
    )

    ОПРЕДЕЛИТЬ МЕТОД (ссылка) фонис() (
        ЗАДАТЬ счет = 0;
        ПОКА ИСТИНА (
            НАПЕЧАТАТЬ "Прив! ИЗ ФОНОВЫЙ ЧЕЛ НОМЕР = " + в_строку(счет);
            счет = счет + 1;
        )
    )
)



ОПРЕДЕЛИТЬ ПРОЦЕДУРУ рабочая_задача(ид, группировщик, ранд) (
    НАПЕЧАТАТЬ "Задача " + в_строку(ид) + " начала работу";

    !спать(ранд:получить_целое_в_диапазоне(1, 3));

    ЖДАТЬ В ФОНЕ спать_в_фоне(2);
    НАПЕЧАТАТЬ "Задача " + в_строку(ид) + " завершилась";
    группировщик:готов();
)

ОПРЕДЕЛИТЬ ПРОЦЕДУРУ фоновая_задача() (
    ЗАДАТЬ счет = 0;
    ПОКА ИСТИНА (
        НАПЕЧАТАТЬ "Прив! НОМЕР = " + в_строку(счет);
        счет = счет + 1;
    )
)


ОПРЕДЕЛИТЬ ПРОЦЕДУРУ вход() (
    ЗАДАТЬ кол_во_задач = 10;

    ЗАДАТЬ группировщик = ГруппировщикЗадач();
    группировщик:добавить(кол_во_задач);
    ЗАДАТЬ ранд = ГенераторСлучайныхЧисел();
    ЗАДАТЬ фоновая = В ФОНЕ фоновая_задача();
    ЗАДАТЬ фоновый_челикс = ФоновыйЧел();

    В ФОНЕ фоновый_челикс:фонис();

    ЦИКЛ i ОТ 1 ДО кол_во_задач (
        В ФОНЕ рабочая_задача(i, группировщик, ранд);
    )

    НАПЕЧАТАТЬ "Ждем завершения всех задач...";
    группировщик:ждать();
    НАПЕЧАТАТЬ "Все задачи завершены!";
)

ВЫПОЛНИТЬ (
	вход();
)



